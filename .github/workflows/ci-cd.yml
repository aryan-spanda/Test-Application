# Application CI/CD - Calls Platform Reusable Workflow
name: Build and Deploy Test Application

on:
  push:
    branches: [main, develop, cicd, testing]
    paths-ignore:
      - 'README.md'
      - 'docs/**'
      - 'RESTRUCTURE.md'
      - 'PLATFORM-REQUIREMENTS.md'
  pull_request:
    branches: [main]

permissions:
  contents: write
  packages: write
  security-events: write

jobs:
  call-platform-workflow:
    name: Platform CI/CD
    uses: aryan-spanda/config-repo/.github/workflows/reusable-platform-ci-cd.yml@main
    with:
      # Application Configuration (optional - will be read from platform-requirements.yml)
      app_name: "Test-Application"
      
      # Test Configuration Files
      test_config: "application-test.yml"
      platform_requirements: "platform-requirements.yml"
      
      # Helm Chart Paths (customize if different from defaults)
      chart_path: "deploy/helm"
      values_dev: "deploy/helm/values-dev.yaml"
      values_staging: "deploy/helm/values-staging.yaml"
      values_prod: "deploy/helm/values-production.yaml"
      
      # Docker Configuration (optional - will be read from platform-requirements.yml)
      dockerfile_path: "./Dockerfile"
      docker_context: "."
      
      # GitOps Configuration
      config_repo: "aryan-spanda/config-repo"
      target_branch: "main"
      
      # Build Configuration
      node_version: "18"
    secrets: inherit
